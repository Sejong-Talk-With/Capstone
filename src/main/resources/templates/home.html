<!DOCTYPE html>
<html lang="en" class="h-100 w-100">
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>웃는흙말랑소</title>

    <!-- Custom fonts for this template-->
    <link href="https://hangeul.pstatic.net/hangeul_static/css/nanum-square-round.css" rel="stylesheet">
    <link href="https://hangeul.pstatic.net/hangeul_static/css/nanum-square.css" rel="stylesheet">
    <link href="https://hangeul.pstatic.net/hangeul_static/css/nanum-square.css" rel="stylesheet">
    <style>
        body {
            font-family: 'NanumSquareRound' !important;
        }
    </style>

    <!-- Custom styles for this template-->
    <link href="css/sb-admin-2.min.css" rel="stylesheet">
    <link href="css/main.css" rel="stylesheet">
    <link href="https://hangeul.pstatic.net/hangeul_static/css/nanum-square-round.css" rel="stylesheet">

</head>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<body style="width: 100%; height: 100%;">

<!-- 지도  -->
<div style="width: 100%; height: 100%; display: flex; justify-content: center; z-index: 1;">
    <div id="map" style="width: 100%; height: 100%;"></div>
</div>

<!-- 검색창 -->
<div style="position:fixed; top:2.5%; z-index: 1; ; width: 100%; display: flex; justify-content: center; padding-left: 10px; ">
    <form class="d-sm-inline-block form-inline navbar-search" style="width: 100%;">
        <div class="input-group">
            <input type="text" class="form-control bg-light border-0 small" placeholder="원하는 장소를 입력하세요"aria-label="Search" aria-describedby="basic-addon2">
            <div class="input-group-append">
                <button class="btn btn-primary" type="button" style="background-color: #F8F9FC; border-color: #F8F9FC;">
                    <svg xmlns="http://www.w3.org/2000/svg" style="fill:gray;" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
                        <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                    </svg>
                </button>
            </div>
            <!-- 토글 버튼  -->
            <button class="btn mr-3" type="button"  style="background-color: #F8F9FC; border-radius: 0px 5px 5px 0px;" onclick="toggleMenu('collapseWidthExample');">
                <i class="fa fa-bars"></i>
            </button>
        </div>
    </form>
</div>


<!-- 메뉴 -->
<div style="width: 100%; position: fixed; top:8%; z-index: 1; display: flex; justify-content: right;  padding-right: 15px;">
    <div>
        <div class="list-group" id="collapseWidthExample" style="display: none;">
            <a href="/" type="button" class="list-group-item list-group-item-action" aria-current="true" style="width: 120px; font-size: 12px; display: flex; justify-content:center;">Map</a>
            <a href="/statics" type="button" class="list-group-item list-group-item-action" style="width: 120px; font-size: 12px; display: flex; justify-content:center;">Statics</a>
        </div>
    </div>
</div>


<!-- 모달 -->
<div th:each="point:${pointList}" class="modal_box" th:id="'pointModal'+${point.id}">
    <div th:object="${point}" class="m">
        <div class="box1">
            <img src="/img/캡처.JPG"  width="100%;" height="100%;" style="border-radius: 15px 15px 15px 15px;">
        </div>
        <div class="box2">
            <div class="m_title" th:text="*{place}">어린이대공원 입구</div>
            <div class="m_text" th:text="'평소보다 '+ *{percentage} + '혼잡'">평소보다 350% 밀집도</div>
            <div class="m_congestion" th:if="${point.percentage >= 200}">매우 혼잡</div>
            <div class="m_congestion" th:if="${ 150 <= point.percentage and point.percentage < 200}">혼잡</div>
            <div class="m_congestion" th:if="${ 100 <= point.percentage and point.percentage < 150}">보통</div>
            <div class="m_congestion" th:if="${ 50 <= point.percentage and point.percentage < 100}">한산</div>
            <div class="m_congestion" th:if="${ 0 <= point.percentage and point.percentage < 50}">매우 한산</div>
            <div class="d-flex justify-content-between">
                <div class="m_num" th:text="*{count} + '명'">84명</div>
                <a th:href="@{/statics/{id} (id=${point.id})}" type="button" class="btn text-white font-weight-bolder btn-sm btn-light" style="background-color: #c9c9c9 !important;">더 보기</a>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    function toggleMenu(id) {
        console.log('id= ', id);
        var e = document.getElementById(id);
        console.log(e);
        if(e.style.display == 'flex')
            e.style.display = 'none';
        else
            e.style.display = 'flex';
    }
</script>

<!-- Page level plugins -->
<script src="vendor/chart.js/Chart.min.js"></script>

<!-- Page level custom scripts -->
<script src="js/demo/chart-area-demo.js"></script>
<script src="js/demo/chart-pie-demo.js"></script>
<script src="js/demo/chart-bar-demo.js"></script>


<!-- Bootstrap core JavaScript-->
<script src="vendor/jquery/jquery.min.js"></script>
<script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

<!-- Core plugin JavaScript-->
<script src="vendor/jquery-easing/jquery.easing.min.js"></script>

<!-- Custom scripts for all pages-->
<script src="js/sb-admin-2.min.js"></script>
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=80205775122803726af920dd7316f936"></script>
<script th:inline="javascript" type="text/javascript">
    var pointList = [[ ${pointList} ]];
    console.log(pointList);
    var container = document.getElementById('map'); //지도를 담을 영역의 DOM 레퍼런스
    var options = { //지도를 생성할 때 필요한 기본 옵션
        center: new kakao.maps.LatLng(37.551126, 127.073899), //지도의 중심좌표. (세종대학교 고정)
        level: 3 //지도의 레벨(확대, 축소 정도)
    };

    var map = new kakao.maps.Map(container, options); //지도 생성 및 객체 리턴



    for (var i=0; i<pointList.length; i++){

        console.log(pointList[i]);
        var id = pointList[i].id;
        var latitude = pointList[i].latitude;
        var longitude = pointList[i].longitude;
        var cus_position = new kakao.maps.LatLng(latitude,  longitude);

        var percentage = pointList[i].percentage;
        var cus_content = '<button class =\"btn btn-danger point\" type=\"button\"onclick=\"toggleMenu(\'pointModal'+id+'\')\";><span class="text1">'+percentage+'%</span></button>';
        console.log(id, latitude, longitude, cus_position, percentage, cus_content);

        new kakao.maps.CustomOverlay({
            position: cus_position,
            content: cus_content,
        }).setMap(map);
    }
</script>




</body>

</html>